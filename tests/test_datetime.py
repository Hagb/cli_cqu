import pytest
from datetime import datetime
from datetime import date
from datetime import timezone, timedelta
from cli_cqu.util.datetime import course_materialize_calendar
from typing import Tuple
START = "2020-02-17"

def dt(*args):
    return datetime(*args, tzinfo=timezone(timedelta(hours=8), "Asia/Shanghai"))

@pytest.mark.parametrize("tw, tl, ex", [
    ("1", "一[1-2节]", (dt(2020, 2, 17, 8, 30), dt(2020, 2, 17, 10, 10))),
    ("1", "一[3-4节]", (dt(2020, 2, 17, 10, 30), dt(2020, 2, 17, 12, 10))),
    ("1", "一[5-6节]", (dt(2020, 2, 17, 13, 30), dt(2020, 2, 17, 15, 10))),
    ("1", "一[7-8节]", (dt(2020, 2, 17, 15, 20), dt(2020, 2, 17, 17, 10))),
    ("1", "一[9-11节]", (dt(2020, 2, 17, 17, 20), dt(2020, 2, 17, 20, 40))),
    ("1", "一[9-12节]", (dt(2020, 2, 17, 17, 20), dt(2020, 2, 17, 21, 35))),
    ("1", "一[14节]", (dt(2020, 2, 17, 8, 30), dt(2020, 2, 17, 23, 59))),
    ("1", "二[1-2节]", (dt(2020, 2, 18, 8, 30), dt(2020, 2, 18, 10, 10))),
    ("1", "二[3-4节]", (dt(2020, 2, 18, 10, 30), dt(2020, 2, 18, 12, 10))),
    ("1", "二[5-6节]", (dt(2020, 2, 18, 13, 30), dt(2020, 2, 18, 15, 10))),
    ("1", "二[7-8节]", (dt(2020, 2, 18, 15, 20), dt(2020, 2, 18, 17, 10))),
    ("1", "二[9-11节]", (dt(2020, 2, 18, 17, 20), dt(2020, 2, 18, 20, 40))),
    ("1", "二[9-12节]", (dt(2020, 2, 18, 17, 20), dt(2020, 2, 18, 21, 35))),
    ("1", "二[14节]", (dt(2020, 2, 18, 8, 30), dt(2020, 2, 18, 23, 59))),
    ("2", "二[1-2节]", (dt(2020, 2, 25, 8, 30), dt(2020, 2, 25, 10, 10))),
    ("2", "二[3-4节]", (dt(2020, 2, 25, 10, 30), dt(2020, 2, 25, 12, 10))),
    ("2", "二[5-6节]", (dt(2020, 2, 25, 13, 30), dt(2020, 2, 25, 15, 10))),
    ("2", "二[7-8节]", (dt(2020, 2, 25, 15, 20), dt(2020, 2, 25, 17, 10))),
    ("2", "二[9-11节]", (dt(2020, 2, 25, 17, 20), dt(2020, 2, 25, 20, 40))),
    ("2", "二[9-12节]", (dt(2020, 2, 25, 17, 20), dt(2020, 2, 25, 21, 35))),
    ("2", "二[14节]", (dt(2020, 2, 25, 8, 30), dt(2020, 2, 25, 23, 59))),
])
def test_materialize_calendar(tw: str, tl: str, ex: Tuple[dt, dt]):
    assert ex == course_materialize_calendar(tw, tl, start=date(2020, 2, 17))
